#!/usr/bin/env bash
# Monitor active Chief Wiggum workers

PROJECT_DIR="$(pwd)"
RALPH_DIR="$PROJECT_DIR/.ralph"

if [ ! -f "$RALPH_DIR/.chief.pid" ]; then
    echo "No active workers found. Run 'chief run' first."
    exit 1
fi

echo "=== Monitoring Chief Wiggum Workers ==="
echo "Press Ctrl+C to stop"
echo

case "${1:-combined}" in
    combined)
        # Show all worker output combined
        tail -f "$RALPH_DIR/logs/workers.log"
        ;;

    split)
        # Show each worker's latest output
        while true; do
            clear
            for worker_dir in "$RALPH_DIR/workers"/worker-*; do
                if [ -f "$worker_dir/worker.log" ]; then
                    worker_name=$(basename "$worker_dir")
                    echo "=== $worker_name ==="
                    tail -10 "$worker_dir/worker.log" 2>/dev/null
                    echo
                fi
            done
            sleep 2
        done
        ;;

    status)
        # Continuous status updates
        watch -n 2 chief-status
        ;;

    *)
        echo "Usage: chief-monitor [combined|split|status]"
        echo "  combined - Show all workers in one stream (default)"
        echo "  split    - Show each worker separately"
        echo "  status   - Continuous status updates"
        exit 1
        ;;
esac
